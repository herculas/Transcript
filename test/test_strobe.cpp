#include <gtest/gtest.h>

#include <vector>

#include "strobe/strobe_128.h"

TEST(Strobe128, conformance) {
    transcript::strobe::Strobe128 strobe("Conformance Test Protocol");

    std::vector<uint8_t> message(1024, 99);

    strobe.meta_ad("ms", false);
    strobe.meta_ad("g", true);
    strobe.ad(message, false);

    std::vector<uint8_t> prf(32, 0);

    strobe.meta_ad("prf", false);
    strobe.prf(prf, false);

    std::vector<uint8_t> prf_expected_1{
            0x76, 0x34, 0xd4, 0x69, 0xaf, 0xf6, 0x96, 0xa6,
            0x4f, 0xeb, 0xeb, 0x93, 0xca, 0x4b, 0xb6, 0xbc,
            0x8f, 0xac, 0xab, 0x60, 0xc9, 0xf5, 0x54, 0x3c,
            0xd1, 0x3a, 0x0b, 0x98, 0xca, 0xd2, 0x6e, 0x33,
    };
    EXPECT_EQ(prf, prf_expected_1);

    strobe.meta_ad("key", false);
    strobe.key(prf, false);

    prf = std::vector<uint8_t>(32, 0);

    strobe.meta_ad("prf", false);
    strobe.prf(prf, false);

    std::vector<uint8_t> prf_expected_2{
            0x7c, 0x20, 0x08, 0x9a, 0xf6, 0x38, 0xa1, 0x7c,
            0xe9, 0x3f, 0x25, 0x7d, 0x67, 0x07, 0x8d, 0x5c,
            0x46, 0x93, 0x33, 0xa0, 0x18, 0xc5, 0x59, 0xa8,
            0x21, 0x1e, 0xec, 0xb3, 0xd2, 0xd0, 0xe7, 0x7c,
    };
    EXPECT_EQ(prf, prf_expected_2);
}